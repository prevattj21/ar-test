<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
    
    <style>
      /* Hide the scanning animation */
      .mindar-ui-scanning { display: none !important; }
      
      /* KILL the VR Button (The goggles icon) */
      .a-enter-vr-button { display: none !important; }

      /* HUD: Floating "Pill" Design */
      #status-message {
        position: absolute;
        bottom: 50px; /* Moved up to avoid Home Bar/UI */
        left: 5%;     /* Center it */
        width: 90%;   /* Prevent clipping off edge */
        box-sizing: border-box; /* Ensures padding doesn't break width */
        
        text-align: center;
        color: #00ffff; 
        font-family: 'Courier New', Courier, monospace; 
        font-weight: bold;
        font-size: 14px; /* Slightly smaller for safety */
        line-height: 1.5em;
        
        background: rgba(0, 0, 0, 0.85); 
        padding: 10px 15px;
        border: 1px solid #00ffff; /* Full border for "Chip" look */
        border-radius: 15px;       /* Rounded corners */
        pointer-events: none;
        z-index: 999;
      }
    </style>

    <script>
      let currentStage = 0; 

      AFRAME.registerComponent('riddle-logic', {
        init: function () {
          const statusText = document.getElementById("status-message");

          function checkAndReveal(targetIndex, requiredStage, nextStageMsg, contentId, textId) {
            const contentEntity = document.querySelector(contentId);
            const textEntity = document.querySelector(textId);
            
            if (currentStage >= requiredStage) {
              
              if (currentStage === requiredStage) {
                currentStage = requiredStage + 1;
                statusText.innerText = ">> UPDATE: " + nextStageMsg; 
                statusText.style.borderColor = "#39ff14"; // Green border flash
                statusText.style.color = "#39ff14";       // Green text flash
                
                setTimeout(() => { 
                  statusText.style.borderColor = "#00ffff"; 
                  statusText.style.color = "#00ffff"; 
                }, 3000);
              }

              contentEntity.setAttribute("visible", "true");
              textEntity.setAttribute("color", "#00ffff"); 
            } 
          }

          // --- EVENT LISTENERS ---
          
          // Target 1: Gallery
          document.querySelector('#target-1').addEventListener("targetFound", event => {
            checkAndReveal(0, 0, "DATA FOUND. SEARCH FOR THE TILE.", "#content-1", "#text-1");
          });

          // Target 2: Tile
          document.querySelector('#target-2').addEventListener("targetFound", event => {
            checkAndReveal(1, 1, "DECRYPTING... FIND THE PEACOCKS.", "#content-2", "#text-2");
          });

          // Target 3: Peacocks
          document.querySelector('#target-3').addEventListener("targetFound", event => {
            checkAndReveal(2, 2, "ALMOST THERE. FIND THE SUNSET.", "#content-3", "#text-3");
          });

          // Target 4: Sunset
          document.querySelector('#target-4').addEventListener("targetFound", event => {
             const contentEntity = document.querySelector("#content-4");
             if (currentStage >= 3) {
               contentEntity.setAttribute("visible", "true");
               statusText.innerText = ">> MISSION COMPLETE.";
               statusText.style.borderColor = "#ff00ff"; 
               statusText.style.color = "#ff00ff"; 
             }
          });
        }
      });
    </script>
  </head>
  <body>
    <div id="status-message">>> SYSTEM READY. SCAN GALLERY.</div>

    <a-scene riddle-logic mindar-image="imageTargetSrc: ./targets.mind;" color-space="sRGB" renderer="colorManagement: true, physicallyCorrectLights" vr-mode-ui="enabled: false" device-orientation-permission-ui="enabled: false">
      <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

      <a-assets>
        <a-mixin id="neon-bg" geometry="primitive: plane; width: 1.1; height: 0.45" material="color: black; opacity: 0.85; transparent: true"></a-mixin>
        <a-mixin id="neon-text" text="font: sourcecodepro; align: center; width: 3; color: #00ffff"></a-mixin>
      </a-assets>

      <a-entity id="target-1" mindar-image-target="targetIndex: 0">
        <a-entity id="content-1" visible="true"> 
           <a-entity position="0 0 0" scale="0.8 0.8 0.8">
              <a-text id="text-1" mixin="neon-text" value="CLUE 01:\nSEARCH"></a-text>
              <a-entity mixin="neon-bg" position="0 0 -0.01"></a-entity>
           </a-entity>
        </a-entity>
      </a-entity>

      <a-entity id="target-2" mindar-image-target="targetIndex: 1">
        <a-entity id="content-2" visible="false">
           <a-entity position="0 0 0" scale="0.8 0.8 0.8">
              <a-text id="text-2" mixin="neon-text" value="CLUE 02:\nHIGH"></a-text>
              <a-entity mixin="neon-bg" position="0 0 -0.01"></a-entity>
           </a-entity>
        </a-entity>
      </a-entity>

      <a-entity id="target-3" mindar-image-target="targetIndex: 2">
        <a-entity id="content-3" visible="false">
           <a-entity position="0 0 0" scale="0.8 0.8 0.8">
              <a-text id="text-3" mixin="neon-text" value="CLUE 03:\nAND"></a-text>
              <a-entity mixin="neon-bg" position="0 0 -0.01"></a-entity>
           </a-entity>
        </a-entity>
      </a-entity>

      <a-entity id="target-4" mindar-image-target="targetIndex: 3">
        <a-entity id="content-4" visible="false">
           <a-entity position="0 0 0" scale="1 1 1"> 
              <a-text id="text-4" font="sourcecodepro" align="center" width="4" color="#39ff14" value="ACCESS GRANTED\n\nTREASURE LOCATION:\nUNDER THE RUG"></a-text>
              <a-plane color="black" opacity="0.9" width="2.2" height="1.3" position="0 0 -0.01"></a-plane>
           </a-entity>
        </a-entity>
      </a-entity>

    </a-scene>
  </body>
</html>
