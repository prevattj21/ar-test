<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
    
    <style>
      .mindar-ui-scanning { display: none !important; }
      .a-enter-vr-button { display: none !important; }

      #status-message {
        position: absolute;
        bottom: 50px; 
        left: 5%;     
        width: 90%;   
        box-sizing: border-box; 
        text-align: center;
        color: #00ffff; 
        font-family: 'Courier New', Courier, monospace; 
        font-weight: bold;
        font-size: 14px; 
        line-height: 1.4em;
        background: rgba(0, 0, 0, 0.85); 
        padding: 15px;
        border: 1px solid #00ffff; 
        border-radius: 15px;       
        pointer-events: none;
        z-index: 999;
        white-space: pre-wrap; /* Essential for handling the newlines */
      }
    </style>

    <script>
      let currentStage = 0; 

      AFRAME.registerComponent('riddle-logic', {
        init: function () {
          const statusText = document.getElementById("status-message");

          // FIX: Set the start message here in JS so the \n works correctly
          statusText.innerText = ">> CLUE 01:\nFIND THE SCENE THAT HANGS ABOUT,\nWITH PLANTS AND TREES\nOF THE PALM HOUSE.";

          function checkAndReveal(targetIndex, requiredStage, nextStageMsg, contentId, textId) {
            const contentEntity = document.querySelector(contentId);
            const textEntity = document.querySelector(textId);
            
            if (currentStage >= requiredStage) {
              
              if (currentStage === requiredStage) {
                currentStage = requiredStage + 1;
                
                statusText.innerText = ">> " + nextStageMsg; 
                statusText.style.borderColor = "#39ff14"; 
                statusText.style.color = "#39ff14";       
                
                setTimeout(() => { 
                  statusText.style.borderColor = "#00ffff"; 
                  statusText.style.color = "#00ffff"; 
                }, 4000);
              }

              contentEntity.setAttribute("visible", "true");
              textEntity.setAttribute("color", "#00ffff"); 
            } 
          }

          // --- EVENT LISTENERS ---
          
          document.querySelector('#target-1').addEventListener("targetFound", event => {
            checkAndReveal(0, 0, "CLUE 1 DECRYPTED.\nCHECK THE 3D TEXT.", "#content-1", "#text-1");
          });

          document.querySelector('#target-2').addEventListener("targetFound", event => {
            checkAndReveal(1, 1, "CLUE 2 DECRYPTED.\nCHECK THE 3D TEXT.", "#content-2", "#text-2");
          });

          document.querySelector('#target-3').addEventListener("targetFound", event => {
            checkAndReveal(2, 2, "CLUE 3 DECRYPTED.\nCHECK THE 3D TEXT.", "#content-3", "#text-3");
          });

          document.querySelector('#target-4').addEventListener("targetFound", event => {
             const contentEntity = document.querySelector("#content-4");
             if (currentStage >= 3) {
               contentEntity.setAttribute("visible", "true");
               statusText.innerText = ">> MISSION COMPLETE.\nREWARD UNLOCKED.";
               statusText.style.borderColor = "#ff00ff"; 
               statusText.style.color = "#ff00ff"; 
             }
          });
        }
      });
    </script>
  </head>
  <body>
    <div id="status-message"></div>

    <a-scene riddle-logic mindar-image="imageTargetSrc: ./targets.mind;" color-space="sRGB" renderer="colorManagement: true, physicallyCorrectLights" vr-mode-ui="enabled: false" device-orientation-permission-ui="enabled: false">
      <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

      <a-assets>
        <a-mixin id="neon-bg" geometry="primitive: plane; width: 1.8; height: 0.75" material="color: black; opacity: 0.85; transparent: true"></a-mixin>
        <a-mixin id="neon-text" text="font: sourcecodepro; align: center; width: 3.6; color: #00ffff"></a-mixin>
      </a-assets>

      <a-entity id="target-1" mindar-image-target="targetIndex: 0">
        <a-entity id="content-1" visible="true"> 
           <a-entity position="0 0 0" scale="0.8 0.8 0.8">
              <a-text id="text-1" mixin="neon-text" value="A BOUQUET CARVED
IN HEAVY STONE,
WITH PETALS DARK
AS OBSIDIAN BONE."></a-text>
              <a-entity mixin="neon-bg" position="0 0 -0.01"></a-entity>
           </a-entity>
        </a-entity>
      </a-entity>

      <a-entity id="target-2" mindar-image-target="targetIndex: 1">
        <a-entity id="content-2" visible="false">
           <a-entity position="0 0 0" scale="0.8 0.8 0.8">
              <a-text id="text-2" mixin="neon-text" value="A ROYAL PAIR
WITH FEATHERS BRIGHT,
A HUNDRED EYES
BUT ZERO SIGHT."></a-text>
              <a-entity mixin="neon-bg" position="0 0 -0.01"></a-entity>
           </a-entity>
        </a-entity>
      </a-entity>

      <a-entity id="target-3" mindar-image-target="targetIndex: 2">
        <a-entity id="content-3" visible="false">
           <a-entity position="0 0 0" scale="0.8 0.8 0.8">
              <a-text id="text-3" mixin="neon-text" value="WHERE FIRE MEETS WATER
AND DAY MEETS NIGHT,
FIND THE SCENE
OF FADING LIGHT."></a-text>
              <a-entity mixin="neon-bg" position="0 0 -0.01"></a-entity>
           </a-entity>
        </a-entity>
      </a-entity>

      <a-entity id="target-4" mindar-image-target="targetIndex: 3">
        <a-entity id="content-4" visible="false">
           <a-entity position="0 0 0" scale="1 1 1"> 
              <a-text id="text-4" font="sourcecodepro" align="center" width="4" color="#39ff14" value="ACCESS GRANTED

TREASURE LOCATION:
UNDER THE RUG"></a-text>
              <a-plane color="black" opacity="0.9" width="2.2" height="1.3" position="0 0 -0.01"></a-plane>
           </a-entity>
        </a-entity>
      </a-entity>

    </a-scene>
  </body>
</html>
