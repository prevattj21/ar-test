<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
    
    <style>
      .mindar-ui-scanning { display: none !important; }
      .a-enter-vr-button { display: none !important; }

      #status-message {
        position: absolute;
        bottom: 50px; 
        left: 5%;     
        width: 90%;   
        box-sizing: border-box; 
        text-align: center;
        color: #00ffff; 
        font-family: 'Courier New', Courier, monospace; 
        font-weight: bold;
        font-size: 14px; 
        line-height: 1.4em;
        background: rgba(0, 0, 0, 0.85); 
        padding: 15px;
        border: 1px solid #00ffff; 
        border-radius: 15px;       
        pointer-events: none;
        z-index: 999;
        white-space: pre-wrap; 
        transition: border-color 0.5s ease, color 0.5s ease;
      }
    </style>

    <script>
      let currentStage = 0; 

      AFRAME.registerComponent('riddle-logic', {
        init: function () {
          const statusText = document.getElementById("status-message");

          // --- STEP 1: INITIAL QUEST ---
          statusText.innerText = ">> CLUE 01:\nFIND THE SCENE THAT HANGS ABOUT,\nWITH PLANTS AND TREES\nOF THE PALM HOUSE.";

          function updateQuestLog(nextRiddleText) {
             // 1. FLASH GREEN (Success)
             statusText.style.borderColor = "#39ff14"; 
             statusText.style.color = "#39ff14";
             statusText.innerText = ">> CLUE DECRYPTED. UPDATING...";

             // 2. SHOW NEW RIDDLE (After 1.5 seconds)
             setTimeout(() => {
                statusText.style.borderColor = "#00ffff"; 
                statusText.style.color = "#00ffff"; 
                statusText.innerText = ">> NEXT OBJECTIVE:\n\n" + nextRiddleText;
             }, 1500);
          }

          function checkAndReveal(targetIndex, requiredStage, nextRiddleText, contentId, textId) {
            const contentEntity = document.querySelector(contentId);
            const textEntity = document.querySelector(textId);
            
            if (currentStage >= requiredStage) {
              if (currentStage === requiredStage) {
                currentStage = requiredStage + 1;
                
                // UPDATE THE HUD PERMANENTLY
                updateQuestLog(nextRiddleText);
              }
              // Still show the 3D text as "Verification" that they found it
              contentEntity.setAttribute("visible", "true");
              textEntity.setAttribute("color", "#00ffff"); 
            } 
          }

          // --- EVENT LISTENERS ---
          
          // 1. Gallery -> Reveals Riddle for TILE
          document.querySelector('#target-1').addEventListener("targetFound", event => {
            const tileRiddle = "A BOUQUET CARVED\nIN HEAVY STONE,\nWITH PETALS DARK\nAS OBSIDIAN BONE.";
            checkAndReveal(0, 0, tileRiddle, "#content-1", "#text-1");
          });

          // 2. Tile -> Reveals Riddle for PEACOCKS
          document.querySelector('#target-2').addEventListener("targetFound", event => {
            const peacockRiddle = "A ROYAL PAIR\nWITH FEATHERS BRIGHT,\nA HUNDRED EYES\nBUT ZERO SIGHT.";
            checkAndReveal(1, 1, peacockRiddle, "#content-2", "#text-2");
          });

          // 3. Peacocks -> Reveals Riddle for SUNSET
          document.querySelector('#target-3').addEventListener("targetFound", event => {
            const sunsetRiddle = "WHERE FIRE MEETS WATER\nAND DAY MEETS NIGHT,\nFIND THE SCENE\nOF FADING LIGHT.";
            checkAndReveal(2, 2, sunsetRiddle, "#content-3", "#text-3");
          });

          // 4. Sunset -> Reveals Riddle for OVEN (Final)
          document.querySelector('#target-4').addEventListener("targetFound", event => {
             const contentEntity = document.querySelector("#content-4");
             if (currentStage >= 3) {
               contentEntity.setAttribute("visible", "true");
               
               // FINAL UPDATE
               statusText.style.borderColor = "#ff00ff"; 
               statusText.style.color = "#ff00ff"; 
               statusText.innerText = ">> MISSION COMPLETE!\n\nVICTORY IS YOURS,\nYOU CAN'T BE BEAT.\nNOW LOOK WHERE WE BAKE\nTHINGS MEANT TO EAT.";
             }
          });
        }
      });
    </script>
  </head>
  <body>
    <div id="status-message"></div>

    <a-scene riddle-logic mindar-image="imageTargetSrc: ./targets.mind;" color-space="sRGB" renderer="colorManagement: true, physicallyCorrectLights" vr-mode-ui="enabled: false" device-orientation-permission-ui="enabled: false">
      <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

      <a-assets>
        <a-mixin id="neon-bg" geometry="primitive: plane; width: 1.8; height: 0.75" material="color: black; opacity: 0.85; transparent: true"></a-mixin>
        <a-mixin id="neon-text" text="font: sourcecodepro; align: center; width: 3.6; color: #00ffff"></a-mixin>
      </a-assets>

      <a-entity id="target-1" mindar-image-target="targetIndex: 0">
        <a-entity id="content-1" visible="true"> 
           <a-entity position="0 0 0" scale="0.8 0.8 0.8">
              <a-text id="text-1" mixin="neon-text" value="CLUE DECRYPTED"></a-text>
              <a-plane color="black" opacity="0.85" width="1.6" height="0.4" position="0 0 -0.01"></a-plane>
           </a-entity>
        </a-entity>
      </a-entity>

      <a-entity id="target-2" mindar-image-target="targetIndex: 1">
        <a-entity id="content-2" visible="false">
           <a-entity position="0 0 0" scale="0.8 0.8 0.8">
              <a-text id="text-2" mixin="neon-text" value="CLUE DECRYPTED"></a-text>
              <a-plane color="black" opacity="0.85" width="1.6" height="0.4" position="0 0 -0.01"></a-plane>
           </a-entity>
        </a-entity>
      </a-entity>

      <a-entity id="target-3" mindar-image-target="targetIndex: 2">
        <a-entity id="content-3" visible="false">
           <a-entity position="0 0 0" scale="0.8 0.8 0.8">
              <a-text id="text-3" mixin="neon-text" value="CLUE DECRYPTED"></a-text>
              <a-plane color="black" opacity="0.85" width="1.6" height="0.4" position="0 0 -0.01"></a-plane>
           </a-entity>
        </a-entity>
      </a-entity>

      <a-entity id="target-4" mindar-image-target="targetIndex: 3">
        <a-entity id="content-4" visible="false">
           <a-entity position="0 0 0" scale="1 1 1"> 
              <a-text id="text-4" font="sourcecodepro" align="center" width="6" color="#ff00ff" value="YOU DID IT!"></a-text>
              <a-plane color="black" opacity="0.9" width="3" height="1" position="0 0 -0.01"></a-plane>
           </a-entity>
        </a-entity>
      </a-entity>

    </a-scene>
  </body>
</html>
